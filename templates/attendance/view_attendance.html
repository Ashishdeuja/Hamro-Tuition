{% extends 'base.html' %}
{% load static %}
{% block page_title %}{{page_title}}{% endblock page_title %}

{% block content %}
<style>

    .pagination {
        display: flex;
        justify-content: center;
        margin-top: 1rem;
        float:right;
        margin-right: 1rem;
      }
      
      .step-links a {
        padding: 0.5rem 1rem;
        background-color: #e1e1e1;
        color: #333;
        text-decoration: none;
        margin-right: 0.5rem;
        border-radius: 5px;
      }
      
      .step-links a:hover {
        background-color: #333;
        color: #fff;
      }
      
      .current-page {
        padding: 0.5rem 1rem;
        background-color: #333;
        color: #fff;
        margin-right: 0.5rem;
        border-radius: 5px;
      }
      .attend{
        float:right;
        margin-right:30px;
        margin-bottom:40px;
      }

      .selection {
        display: flex;
        float:right;
        align-items: center;
        margin-bottom: 20px;
        margin-right:50px;
        {% comment %} margin-top:-3%; {% endcomment %}
      }
      
      .selection label {
        font-weight: bold;
        margin-right: 10px;
      }
      
      .selection select {
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
      }
        
      
      select:hover{
        cursor: pointer;
      }
      input,input[type="text"] {
        width: 25%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        margin-right: 10px;
        margin-left:2%;
      }
      input{
        width:12%;
      }
      button[type="submit"] {
        width: 10%;
        padding: 10px;
        background-color: #4CAF50;
        color: white;
        border: 1px solid #ccc;
        border-radius: 5px;
        cursor: pointer;
      }
</style>

{% if request.user.user_type == '2' %}
<div class='attend'>
  <a href='{% url "create_attendance" session_id section_id %}' class="btn btn-primary">Take</a>
  <a href='{% url "edit_attendance" session_id section_id %}' class="btn btn-primary">Edit</a>
  {% comment %} <a href='{% url "teacher_download_all_attendance" session_id section_id %}' class="btn btn-success">Report</a> {% endcomment %}
  <div class="btn-group" role="group" >
    <button id="btnGroupDrop1" type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      Reports
    </button>
    <div class="dropdown-menu" aria-labelledby="btnGroupDrop1"style="margin-left:-55px;">
      <a href="{% url 'daily_all_attendance' session_id section_id %}" class="dropdown-item">Daily Report</a>
      <a href="{% url 'weekly_all_attendance' session_id section_id %}" class="dropdown-item">Weekly Report</a>
      <a href="{% url 'admin_download_all_attendance' session_id section_id %}" class="dropdown-item">Monthly Report</a>
      <a href="{% url 'yearly_all_attendance' session_id section_id %}" class="dropdown-item">Yearly Report</a>
    </div>
  </div>
</div>
{% endif %}
<br/><br/><br/>
  <section class="content">
    <div class="container-fluid">
       {% comment %}  <table class='table'>
            <thead>
                <tr>
                  <th>Student Name</th>
                  <th>Date</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                {% for student in students %}
                  {% for attend in attendance %}
                    {% if attend.student == student %}
                      <tr>
                        <td>{{ student.admin.first_name }} {{ student.admin.last_name }}</td>
                        <td>{{ attend.date }}</td>
                        <td>
                          {% if attend.present %}
                            Present
                          {% else %}
                            Absent
                          {% endif %}
                        </td>
                      </tr>
                    {% endif %}
                  {% endfor %}
                {% endfor %}
              </tbody>
          </table>
    </div>
</section> {% endcomment %}

<div>
  <form method="get">
    {% csrf_token %}
    <input type="text" name="q" placeholder="Search...">
        <button type="submit">Search</button>

        <input type="date" name="start_date" id="start_date"> to
        <input type="date" name="end_date" id="end_date">
    <div class="selection">
    <label>Filter: </label>
    <select name="status" onchange="this.form.submit()">
      <option value="">All</option>
      <option value="present" {% if request.GET.status == 'present' %}selected{% endif %}>Present</option>
      <option value="absent" {% if request.GET.status == 'absent' %}selected{% endif %}>Absent</option>
    </select>
    </div>
  </form>
</div>
<br/><br/>
{% for month, records in attendance_by_month_paginated %}

  <h3 style='text-align:center;'>Attendance of {{ month }}</h3>
  <table class='table'>
    <thead>
      <tr>
        <th>Student Name</th>
        <th>Date</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody>
        {% for student in students %}
          {% for attend in records %}
            {% if attend.student == student %}
              <tr>
                <td>{{ student.admin.first_name }} {{ student.admin.last_name }}</td>
                <td>{{ attend.date }}</td>
                <td>
                  {% if attend.present %}
                    Present
                  {% else %}
                    Absent
                  {% endif %}
                </td>
               
              </tr>
            {% endif %}
          {% endfor %}
        {% endfor %}
      </tbody>

  </table>
  <div class="pagination">
    <span class="step-links">
      {% if attendance_by_month_paginated.has_previous %}
        <a href="?page=1"> &laquo;</a>
        <a href="?page={{ attendance_by_month_paginated.previous_page_number }}">{{ attendance_by_month_paginated.previous_page_number }}</a>
      {% endif %}
      <span class="current-page">
        {{ attendance_by_month_paginated.number }}
      </span>
      {% if attendance_by_month_paginated.has_next %}
        <a href="?page={{ attendance_by_month_paginated.next_page_number }}">{{ attendance_by_month_paginated.next_page_number }}</a>
        <a href="?page={{ attendance_by_month_paginated.paginator.num_pages }}">&raquo; </a>
      {% endif %}
    </span>
  </div>
{% endfor %}

</div>
</section> 

{% endblock content %}
{% block custom_js%}
<script>
  const btnGroups = document.querySelectorAll('.btn-group');

  btnGroups.forEach(function(btnGroup) {
    const dropdownToggle = btnGroup.querySelector('.dropdown-toggle');
    const dropdownMenu = btnGroup.querySelector('.dropdown-menu');

    dropdownToggle.addEventListener('click', function() {
      dropdownMenu.classList.toggle('show');
    });

    window.addEventListener('click', function(event) {
      if (!dropdownToggle.contains(event.target) && !dropdownMenu.contains(event.target)) {
        dropdownMenu.classList.remove('show');
      }
    });
  });
</script>
{% endblock custom_js %}